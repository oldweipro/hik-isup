<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jessibuca HTTP-FLV ç›´æ¥æ’­æ”¾</title>
    <style>
        html, body {
            background: #111;
            margin: 0;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: #eee;
            font-family: sans-serif;
        }

        .wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 90%;
            max-width: 800px;
        }

        #container {
            width: 100%;
            height: 450px;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
            min-width: 300px;
        }

        .control-panel {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        button {
            background: #0a84ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            flex: 1;
            min-width: 100px;
        }

        button:hover {
            background: #0668d1;
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        button.stop {
            background: #ff5555;
        }

        button.stop:hover {
            background: #cc3333;
        }

        .status {
            font-size: 14px;
            color: #aaa;
            min-height: 20px;
            text-align: center;
        }

        .status.playing {
            color: #4caf50;
        }

        .status.error {
            color: #ff5555;
        }

        .status.loading {
            color: #ffa500;
        }

        #urlInput {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
            background: #222;
            color: #eee;
            font-size: 14px;
            box-sizing: border-box;
        }

        #urlInput:focus {
            outline: none;
            border-color: #0a84ff;
        }

        .example {
            font-size: 12px;
            color: #777;
            margin-top: -8px;
        }
    </style>
</head>
<body>
<div class="wrapper">
    <h2>ğŸ¥ Jessibuca HTTP-FLV ç›´æ¥æ’­æ”¾</h2>

    <input type="text" id="urlInput" placeholder="è¯·è¾“å…¥å®Œæ•´çš„ HTTP-FLV æµåœ°å€ï¼Œä¾‹å¦‚ï¼šhttp://example.com/live/stream.flv">

    <div class="example">æ³¨æ„ï¼šåœ°å€å¿…é¡»å¯å…¬å¼€è®¿é—®ï¼Œä¸”ä¸ºæœ‰æ•ˆçš„ HTTP-FLV æµ</div>

    <div id="container"></div>

    <div class="control-panel">
        <button id="playBtn">â–¶ï¸ å¼€å§‹æ’­æ”¾</button>
        <button id="stopBtn" class="stop" disabled>â¹ï¸ åœæ­¢æ’­æ”¾</button>
    </div>

    <div class="status" id="status">è¯·è¾“å…¥æµåœ°å€</div>
</div>

<script>
    let player = null;
    let isPlaying = false;

    const urlInput = document.getElementById('urlInput');
    const playBtn = document.getElementById('playBtn');
    const stopBtn = document.getElementById('stopBtn');
    const statusEl = document.getElementById('status');

    function updateStatus(message, type = 'normal') {
        statusEl.textContent = message;
        statusEl.className = 'status ' + type;
    }

    function setButtonState(playing) {
        playBtn.disabled = playing;
        stopBtn.disabled = !playing;
        isPlaying = playing;
    }

    async function checkJessibuca() {
        if (typeof Jessibuca !== 'undefined') return;
        return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = './jessibuca/jessibuca.min.js';
            script.onload = resolve;
            script.onerror = () => reject(new Error('æ— æ³•åŠ è½½ Jessibuca åº“'));
            document.head.appendChild(script);
        });
    }

    playBtn.onclick = async () => {
        const playURL = urlInput.value.trim();
        if (!playURL) return updateStatus('âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„ HTTP-FLV åœ°å€', 'error');
        if (!playURL.startsWith('http://') && !playURL.startsWith('https://')) {
            return updateStatus('âŒ åœ°å€å¿…é¡»ä»¥ http:// æˆ– https:// å¼€å¤´', 'error');
        }

        updateStatus('â³ æ­£åœ¨åŠ è½½æ’­æ”¾å™¨...', 'loading');
        setButtonState(true);

        try {
            await checkJessibuca();
            if (player) player.destroy();

            player = new Jessibuca({
                container: document.getElementById('container'),
                isFlv: true,
                liveMode: true,
                videoBuffer: 0.2,
                bufferTime: 100,
                isResize: true,
                isFullScreen: true,
                hasAudio: true,
                showBandwidth: true,
                loadingTimeout: 10,
                decoder: "./jessibuca/decoder.js",
                debug: false,
                loadingText: "æ­£åœ¨è¿æ¥..."
            });

            player.on("play", () => updateStatus('âœ… æ­£åœ¨æ’­æ”¾', 'playing'));
            player.on("error", e => {
                updateStatus(`âŒ æ’­æ”¾é”™è¯¯: ${e}`, 'error');
                setButtonState(false);
            });
            player.on("disconnect", () => {
                updateStatus('âš ï¸ è¿æ¥æ–­å¼€', 'error');
                setButtonState(false);
            });

            console.log("â–¶ï¸ å¼€å§‹æ’­æ”¾:", playURL);
            player.play(playURL);

            // å°è¯•è‡ªåŠ¨æ’­æ”¾ï¼ˆé™éŸ³ï¼‰
            const videoEl = document.querySelector('#container video');
            if (videoEl) {
                videoEl.muted = true;
                videoEl.play().catch(() => {});
            }
        } catch (err) {
            console.error(err);
            updateStatus(`âŒ ${err.message}`, 'error');
            setButtonState(false);
        }
    };

    stopBtn.onclick = () => {
        if (player) {
            player.destroy();
            player = null;
        }
        updateStatus('å·²åœæ­¢æ’­æ”¾', 'normal');
        setButtonState(false);
    };

    window.addEventListener('beforeunload', () => {
        if (player) player.destroy();
    });
</script>
</body>
</html>